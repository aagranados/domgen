/* DO NOT EDIT: File is auto-generated */
package <%= to_package(repository.ee.qualified_abstract_app_server_name) %>;

@javax.annotation.Generated( "Domgen" )
public abstract class <%= repository.ee.abstract_app_server_name %>
  extends org.realityforge.guiceyloops.server.glassfish.AbstractAppServer
{
  private static final String APP_NAME = "<%= Domgen::Naming.underscore(repository.name) %>";

  @java.lang.Override
  protected String getContextRoot()
  {
    return "/" + APP_NAME;
  }

<%
  repository.data_modules.select{|dm|dm.jws?}.each do |data_module|
    data_module.services.select{|s|s.jws?}.each do |service|
-%>
  public final String get<%= service.data_module.name %><%= service.name %>EndpointAddress()
  {
    return getSiteURL() + "<%= service.jws.url %>";
  }
<%
    end
  end
-%>

  @java.lang.Override
  protected void configureGlassFish( @javax.annotation.Nonnull final org.realityforge.guiceyloops.server.glassfish.GlassFishContainer glassfish )
    throws Exception
  {
<% if repository.jpa? && repository.jpa.include_default_unit? -%>

    // Database Configuration Start
<% if repository.mssql? -%>
    glassfish.createSqlServerJdbcResource( <%= repository.jpa.qualified_unit_descriptor_name %>.RESOURCE_NAME );
<% else -%>
    glassfish.createPostgresJdbcResource( <%= repository.jpa.qualified_unit_descriptor_name %>.RESOURCE_NAME );
<% end -%>
    // Database Configuration Ende

<% end -%>
<% if repository.jms? -%>

    // JMS Configuration Start
    // iiop required for JMS
    glassfish.createLocalIiopListener( "<%= Domgen::Naming.underscore(repository.name) %>/iiop_listener" );
    glassfish.deleteDefaultIiopListeners();

    glassfish.setDefaultJmsHost( "<%= Domgen::Naming.underscore(repository.name) %>/jms/host", getOpenMQContainer() );
    glassfish.createJmsConnectionFactory( "<%= repository.jms.connection_factory_resource_name %>", getOpenMQContainer() );

<% repository.jms.endpoint_methods.select{|method| method.jms.destination_type == 'javax.jms.Queue'}.each do |method| -%>
    glassfish.createJmsQueue( "<%= method.jms.destination_resource_name %>", "<%= method.jms.physical_resource_name %>" );
<% end -%>
<% repository.jms.endpoint_methods.select{|method| method.jms.destination_type == 'javax.jms.Topic'}.each do |method| -%>
    glassfish.createJmsTopic( "<%= method.jms.destination_resource_name %>", "<%= method.jms.physical_resource_name %>" );
<% end -%>
    // JMS Configuration Ende

<% end -%>
<% if repository.mail? -%>

    // Mail Configuration Start
    // TODO: Consider sending mail to greenmail
    glassfish.createJavamailResource( "<%= repository.mail.resource_name %>", "mail.example.com", "bob", "bob@example.com" );
    // Mail Configuration Ende

<% end -%>
  }

  @java.lang.Override
  protected void performDeploy()
    throws Exception
  {
    getGlassfish().deploy( getContextRoot(), APP_NAME, org.realityforge.guiceyloops.server.glassfish.GlassFishContainerUtil.getWarFile() );
  }
}
