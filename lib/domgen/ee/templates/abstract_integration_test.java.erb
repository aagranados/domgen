/* DO NOT EDIT: File is auto-generated */
package <%= to_package(repository.ee.qualified_abstract_integration_test_name) %>;

@javax.annotation.Generated( "Domgen" )
public abstract class <%= repository.ee.abstract_integration_test_name %>
  extends <%= repository.jpa? ? repository.jpa.qualified_base_entity_test_name : 'org.realityforge.guiceyloops.server.AbstractServerTest' %>
{
  @org.testng.annotations.BeforeSuite
  public void setUpServices()
    throws Exception
  {
    getAppServer().setUp();
  }

  @org.testng.annotations.AfterSuite
  public void tearDownServices()
  {
    getAppServer().tearDown();
  }

  @javax.annotation.Nonnull
  protected final <%= repository.ee.qualified_app_server_name %> getAppServer()
  {
    return <%= repository.ee.qualified_app_server_factory_name %>.getAppServer();
  }

  @java.lang.Override
  protected com.google.inject.Module[] getModules()
  {
    final java.util.ArrayList<com.google.inject.Module> modules = new java.util.ArrayList<>();
    java.util.Collections.addAll( modules, super.getModules() );
<% if repository.imit? -%>
    modules.add( new <%= repository.imit.qualified_integration_module_name %>() );
<% end -%>
    return modules.toArray( new com.google.inject.Module[ modules.size() ] );
  }
<% if repository.appconfig? -%>

  protected java.lang.String[] getFeatureFlagsToDisable()
  {
    return new java.lang.String[ 0 ];
  }

  @java.lang.Override
  protected void postInjector()
  {
    final javax.persistence.EntityTransaction transaction = getInstance( iris.appconfig.server.entity.AppConfigPersistenceUnit.NAME, javax.persistence.EntityManager.class ).getTransaction();
    transaction.begin();
    for( final java.lang.String flag : getFeatureFlagsToDisable() )
    {
      s( iris.appconfig.server.service.FeatureFlagService.class ).disableFeature( flag );
    }
    transaction.commit();
  }

  static class NoDeleteAppConfigPersistenceTestModule
    extends org.realityforge.guiceyloops.server.PersistenceTestModule
  {
    NoDeleteAppConfigPersistenceTestModule()
    {
      super( iris.appconfig.server.entity.AppConfigPersistenceUnit.NAME, new String[ 0 ], null, newDefaultProperties() );
    }

    @javax.annotation.Nonnull
    private static java.util.Properties newDefaultProperties()
    {
      final java.util.Properties properties = new java.util.Properties();
      properties.put( "javax.persistence.jdbc.driver", "<%= repository.sql.sql_driver %>" );
      return properties;
    }
  }

  @java.lang.Override
  protected final com.google.inject.Module newAppConfigPersistenceEntityModule()
  {
    return new NoDeleteAppConfigPersistenceTestModule();
  }
<% end -%>
}
