/* DO NOT EDIT: File is auto-generated */
package <%= service.data_module.ejb.service_package %>;

@SuppressWarnings( { "UnusedDeclaration", "JavaDoc" } )
@javax.ejb.Stateless( name = <%= service.ejb.facade_interface_name %>.EJB_NAME )
@javax.ejb.TransactionAttribute( javax.ejb.TransactionAttributeType.REQUIRES_NEW )
public class <%= service.ejb.facade_implementation_name %>
  implements <%= service.ejb.facade_interface_name %>
{
<% service.methods.collect {|method|method.parameters.select{|parameter|parameter.reference?}.collect{|parameter|parameter.referenced_entity}}.flatten.sort.uniq.each do |entity| %>
  @javax.ejb.EJB
  private <%= entity.jpa.qualified_dao_name %> _<%= entity.qualified_name.gsub('.','') %>DAO;
<% end %>
  @javax.ejb.EJB
  private <%= service.ejb.service_name %> _service;

<% service.methods.each do |method|
%>  public <%= annotated_type(method.return_value, :ejb, :transport) %> <%= method.ejb.name %>(<%= method.parameters.collect{|p| "#{annotated_type(p, :ejb, :transport)} #{p.ejb.name}" }.join(', ') %>)<%=
    method.exceptions.empty? ? '' : "\n    throws #{method.exceptions.collect{|e| e.ejb.qualified_name}.join(', ')}"
%><%
   return_prefix = ''
   transform = ''
   if method.return_value.return_type != :void
     if method.return_value.ejb.java_type == method.return_value.ejb.java_type(:transport)
       return_prefix = "return "
     else
       return_prefix = "#{annotated_type(method.return_value, :ejb)} value = "
       transform = "value"
       if method.return_value.return_type == :enumeration && method.return_value.enumeration.numeric_values?
         transform = "value.ordinal()"
       elsif method.return_value.return_type == :reference
         transform = "value.get#{method.return_value.referenced_entity.primary_key.jpa.name}()"
       end
       if method.return_value.nullable?
         transform = "null == value ? null : #{transform}"
       end
       transform = "return #{transform};"
     end
   end
%>
  {
<% method.parameters.select{|parameter| parameter.reference?}.each do |parameter|
%>    final <%= annotated_type(parameter, :ejb) %> $<%= parameter.ejb.name %> = <%= parameter.nullable? ? "null == #{parameter.ejb.name} ? null : " : "" %> _<%= parameter.referenced_entity.qualified_name.gsub('.','') %>DAO.getByID( <%= parameter.ejb.name %> );
<% end %>
<% method.parameters.select{|parameter| parameter.enumeration?}.each do |parameter|
%>    final <%= annotated_type(parameter, :ejb) %> $<%= parameter.ejb.name %> = <%= parameter.nullable? ? "null == #{parameter.ejb.name} ? null : " : "" %> <%= parameter.ejb.java_type %>.values()[ <%= parameter.ejb.name %> ];
<% end %>
  <%= return_prefix  %>_service.<%= method.ejb.name %>(<%= method.parameters.collect{|parameter| "#{(parameter.reference? || parameter.enumeration?) ? '$' : ''}#{parameter.ejb.name}" }.join(', ') %>);
  <%= transform %>
  }

<% end %>}
