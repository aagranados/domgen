/* DO NOT EDIT: File is auto-generated */
package <%= to_package(repository.imit.qualified_abstract_session_context_impl_name) %>;

/**
 * Subclass this class using the following conventions.
 *
 * <pre>
 * \@ApplicationScoped
 * \@Transactional
 * \@Typed( <%= repository.service_by_name(repository.imit.session_context_service).ejb.service_name %>.class )
 * public class <%= repository.service_by_name(repository.imit.session_context_service).ejb.service_implementation_name %>
 *   extends <%= repository.imit.abstract_session_context_impl_name %>
 * {
 * ...
 * }
 * </pre>
 */
@javax.annotation.Generated( "Domgen" )
@java.lang.SuppressWarnings( { "PMD.SwitchStmtsShouldHaveDefault" } )
public abstract class <%= repository.imit.abstract_session_context_impl_name %>
  implements <%= repository.service_by_name(repository.imit.session_context_service).ejb.qualified_service_name %>
{
<% if repository.imit.support_subscription_access_control? -%>
  @java.lang.Override
  public void preSubscribe( @javax.annotation.Nonnull final org.realityforge.replicant.server.transport.ReplicantSession session, @javax.annotation.Nonnull final org.realityforge.replicant.server.ChannelAddress address, @javax.annotation.Nullable final Object filter )
  {
  }

<% end -%>
<% repository.imit.graphs.select{|graph|graph.instance_root? && graph.bulk_load?}.each do |graph| -%>
  @java.lang.Override
  public void bulkCollectDataFor<%= graph.name %>( @javax.annotation.Nonnull final org.realityforge.replicant.server.transport.ReplicantSession session, @javax.annotation.Nonnull final java.util.List<org.realityforge.replicant.server.ChannelAddress> addresses<% if graph.filter_parameter -%>, <%= nullability_annotation(graph.filter_parameter.nullable?) %> final <%= Domgen::Java.java_type(graph.filter_parameter, :ee, :default) %> filter<% end %>, final boolean explicitSubscribe )
  {
    performBulkCollectDataFor<%= graph.name %>( session, addresses<% if graph.filter_parameter -%>, filter<% end %>, explicitSubscribe );
  }

  protected abstract void performBulkCollectDataFor<%= graph.name %>( @javax.annotation.Nonnull org.realityforge.replicant.server.transport.ReplicantSession session, @javax.annotation.Nonnull java.util.List<org.realityforge.replicant.server.ChannelAddress> addresses<% if graph.filter_parameter -%>, <%= nullability_annotation(graph.filter_parameter.nullable?) %> <%= Domgen::Java.java_type(graph.filter_parameter, :ee, :default) %> filter<% end %>, boolean explicitSubscribe );

<% end -%>
<% repository.imit.graphs.select{|graph|graph.instance_root? && graph.bulk_load? && graph.filtered? && !graph.filter_parameter.immutable?}.each do |graph| -%>
  @java.lang.Override
  public void bulkCollectDataFor<%= graph.name %>Update( @javax.annotation.Nonnull final org.realityforge.replicant.server.transport.ReplicantSession session, @javax.annotation.Nonnull final java.util.List<org.realityforge.replicant.server.ChannelAddress> addresses, <%= nullability_annotation(graph.filter_parameter.nullable?) %> final <%= Domgen::Java.java_type(graph.filter_parameter, :ee, :default) %> originalFilter, <%= nullability_annotation(graph.filter_parameter.nullable?) %> final <%= Domgen::Java.java_type(graph.filter_parameter, :ee, :default) %> filter )
  {
    performBulkCollectDataFor<%= graph.name %>Update( session, addresses, originalFilter, filter );
  }

  protected abstract void performBulkCollectDataFor<%= graph.name %>Update( @javax.annotation.Nonnull org.realityforge.replicant.server.transport.ReplicantSession session, @javax.annotation.Nonnull java.util.List<org.realityforge.replicant.server.ChannelAddress> addresses, <%= nullability_annotation(graph.filter_parameter.nullable?) %> <%= Domgen::Java.java_type(graph.filter_parameter, :ee, :default) %> originalFilter, <%= nullability_annotation(graph.filter_parameter.nullable?) %> <%= Domgen::Java.java_type(graph.filter_parameter, :ee, :default) %> filter );

<% end -%>
<%
repository.imit.graphs.select{|graph| graph.filtered?}.each do |graph|
  extra_params = ''
  extra_args = ''
  mutable_routing_keys = false
  graph.routing_keys.each do |routing_key|
    nullable = !graph.instance_root?||!(routing_key.imit_attribute.attribute.entity.qualified_name==graph.instance_root)
    mutable_routing_keys ||= !routing_key.referenced_attribute.immutable?
    type = Domgen::Java.non_primitive_java_type(routing_key.referenced_attribute, :ee, :boundary)
    type = "java.util.List<#{type}>" if routing_key.multivalued?
    extra_params += ", #{nullability_annotation(nullable)} final #{type} #{Reality::Naming.camelize(routing_key.name)}"
    extra_args += ", #{Reality::Naming.camelize(routing_key.name)}"
  end
  -%>
<% if mutable_routing_keys -%>
  @javax.annotation.Nonnull
  protected abstract org.realityforge.replicant.server.transport.FilterResult test<%= graph.name %>Interesting( @javax.annotation.Nonnull final org.realityforge.replicant.server.EntityMessage message, @javax.annotation.Nonnull final org.realityforge.replicant.server.transport.ReplicantSession session <% if graph.instance_root? %>, @javax.annotation.Nonnull final <% entity = repository.entity_by_name(graph.instance_root) %> <%= entity.primary_key.jpa.non_primitive_java_type %> <%= Reality::Naming.camelize("#{entity.name}#{entity.primary_key.name}") %> <% end %><% if graph.filter_parameter? %>, <%= nullability_annotation(graph.filter_parameter.nullable?) %> final <%= Domgen::Java.java_type(graph.filter_parameter, :ee, :default) %> filter <% end %><%= extra_params %> );

  @java.lang.Override
  @javax.annotation.Nullable
  public org.realityforge.replicant.server.EntityMessage filterMessageOfInterestIn<%= graph.name %>Graph( @javax.annotation.Nonnull final org.realityforge.replicant.server.EntityMessage message, @javax.annotation.Nonnull final org.realityforge.replicant.server.transport.ReplicantSession session <% if graph.instance_root? %>, @javax.annotation.Nonnull final <%entity = repository.entity_by_name(graph.instance_root) %> <%= entity.primary_key.jpa.non_primitive_java_type %> <%= Reality::Naming.camelize("#{entity.name}#{entity.primary_key.name}") %> <% end %><% if graph.filter_parameter? %>, <%= nullability_annotation(graph.filter_parameter.nullable?) %> final <%= Domgen::Java.java_type(graph.filter_parameter, :ee, :default) %> filter <% end %><%= extra_params %> )
  {
    final org.realityforge.replicant.server.transport.FilterResult result = test<%= graph.name %>Interesting( message, session<% if graph.instance_root? %>, <% entity = repository.entity_by_name(graph.instance_root) %> <%= Reality::Naming.camelize("#{entity.name}#{entity.primary_key.name}") %> <% end %><%if graph.filter_parameter? %>, filter <% end %><%= extra_args %> );
    if ( org.realityforge.replicant.server.transport.FilterResult.KEEP == result )
    {
      return message;
    }
    else if ( org.realityforge.replicant.server.transport.FilterResult.DELETE == result )
    {
      return message.toDelete();
    }
    else
    {
      return null;
    }
  }
<% else -%>
  protected abstract boolean is<%= graph.name %>Interesting( @javax.annotation.Nonnull final org.realityforge.replicant.server.EntityMessage message, @javax.annotation.Nonnull final org.realityforge.replicant.server.transport.ReplicantSession session <% if graph.instance_root? %>, @javax.annotation.Nonnull final <% entity = repository.entity_by_name(graph.instance_root) %> <%= entity.primary_key.jpa.non_primitive_java_type %> <%= Reality::Naming.camelize("#{entity.name}#{entity.primary_key.name}") %> <% end %><% if graph.filter_parameter? %>, <%= nullability_annotation(graph.filter_parameter.nullable?) %> final <%= Domgen::Java.java_type(graph.filter_parameter, :ee, :default) %> filter <% end %><%= extra_params %> );

  @java.lang.Override
  @javax.annotation.Nullable
  public org.realityforge.replicant.server.EntityMessage filterMessageOfInterestIn<%= graph.name %>Graph( @javax.annotation.Nonnull final org.realityforge.replicant.server.EntityMessage message, @javax.annotation.Nonnull final org.realityforge.replicant.server.transport.ReplicantSession session <% if graph.instance_root? %>, @javax.annotation.Nonnull final <%entity = repository.entity_by_name(graph.instance_root) %> <%= entity.primary_key.jpa.non_primitive_java_type %> <%= Reality::Naming.camelize("#{entity.name}#{entity.primary_key.name}") %> <% end %><% if graph.filter_parameter? %>, <%= nullability_annotation(graph.filter_parameter.nullable?) %> final <%= Domgen::Java.java_type(graph.filter_parameter, :ee, :default) %> filter <% end %><%= extra_params %> )
  {
    if ( is<%= graph.name %>Interesting( message, session<% if graph.instance_root? %>, <% entity = repository.entity_by_name(graph.instance_root) %> <%= Reality::Naming.camelize("#{entity.name}#{entity.primary_key.name}") %> <% end %><%if graph.filter_parameter? %>, filter <% end %><%= extra_args %> ) )
    {
      return message;
    }
    else
    {
      return null;
    }
  }
<% end -%>
<% end -%>
<% repository.imit.graphs.each do |graph| -%>
<%
  if graph.instance_root? && graph.filtered?
graph.reachable_entities.collect { |n| repository.entity_by_name(n) }.select { |entity| entity.imit? && entity.concrete? }.each do |entity|
  outgoing_links = entity.referencing_attributes.select { |a| a.arez? && a.inverse.arez.traversable? && a.jpa? && a.inverse.jpa.java_traversable? && a.inverse.imit.replication_edges.include?(graph.name) }
  outgoing_links.each do |a|
    if a.inverse.multiplicity == :many
 -%>

  @java.lang.Override
  public java.util.List<<%= a.entity.jpa.qualified_name %>> get<%= a.inverse.attribute.qualified_name.gsub('.', '') %>In<%= graph.name %>Graph( @javax.annotation.Nonnull final <%= a.referenced_entity.jpa.qualified_name %> entity<% if graph.filter_parameter? %>, <%= nullability_annotation(graph.filter_parameter.nullable?) %> final <%= Domgen::Java.java_type(graph.filter_parameter, :ee, :default) %> filter<% end %> )
  {
    return entity.get<%= Reality::Naming.pascal_case(Reality::Naming.pluralize(a.inverse.name)) %>();
  }
<%
    elsif a.inverse.multiplicity == :one || a.inverse.multiplicity == :zero_or_one
 -%>

  @java.lang.Override
  public <%= a.entity.jpa.qualified_name %> get<%= a.inverse.attribute.qualified_name.gsub('.', '') %>In<%= graph.name %>Graph( @javax.annotation.Nonnull final <%= a.referenced_entity.jpa.qualified_name %> entity<% if graph.filter_parameter? %>, <%= nullability_annotation(graph.filter_parameter.nullable?) %> final <%= Domgen::Java.java_type(graph.filter_parameter, :ee, :default) %> filter<% end %> )
  {
    return entity.get<%= Reality::Naming.pascal_case(a.inverse.name) %>();
  }
<%
    end
  end
end
end
-%>
<% end -%>
}
