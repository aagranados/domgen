/* DO NOT EDIT: File is auto-generated */
package <%= service.data_module.gwt.server_package %>;

<%= description_javadoc_for(service, "") %>@javax.annotation.Generated( "Domgen" )
@SuppressWarnings( { "UnusedDeclaration", "JavaDoc" } )
@javax.servlet.annotation.WebServlet( name = "<%= service.data_module.name %>.<%= service.gwt.servlet_name %>", urlPatterns = { "/<%= service.data_module.repository.gwt.module_name %>/" + <%= service.gwt.qualified_service_name %>.PATH } )
public class <%= service.gwt.servlet_name %>
  extends com.google.gwt.user.server.rpc.<%= service.gwt.xsrf_protected? ? "XsrfProtectedServiceServlet" : "RemoteServiceServlet" %>
  implements <%= service.gwt.qualified_service_name %>
{
  @javax.ejb.EJB
  private <%= service.ejb.generate_boundary? ? service.ejb.qualified_boundary_interface_name : service.ejb.qualified_service_name %> _service;

<% service.methods.each do |method|
%><%= description_javadoc_for(method)
%>  public <%= annotated_type(method.return_value, :gwt, :transport) %> <%= method.gwt.name %>(<%= method.parameters.select{|parameter| !parameter.gwt.environmental?}.collect{|p| "#{annotated_type(p, :gwt, :transport)} #{p.gwt.name}" }.join(', ') %>)<%=
    method.exceptions.empty? ? '' : "\n    throws #{method.exceptions.collect{|e| e.gwt.qualified_name}.join(', ')}"
%>
  {
<% if !method.exceptions.empty?
%>    try
    {
<% end %>
<%
   return_prefix = ''
   return_postfix = ''
   if method.return_value.return_type != :void
     return_prefix = "final #{annotated_type(method.return_value, :ejb, :boundary)} returnValue = "
     transform = nil
     if method.return_value.date?
       transform = "org.realityforge.replicant.client.RDate.fromDate( returnValue )"
     elsif method.return_value.enumeration?
       if method.return_value.enumeration.numeric_values?
         transform = "returnValue.ordinal()"
       else
         transform = "returnValue.name()"
       end
     end

     if !method.return_value.collection?
       if method.return_value.nullable? && transform
         transform = "(null == returnValue ? null : #{transform})"
       end
       return_postfix = "return #{transform || "returnValue"};"
     elsif method.return_value.date? || method.return_value.enumeration?
       return_postfix = ""
       return_postfix << "final #{annotated_type(method.return_value, :ejb, :transport)} $returnValue = #{method.return_value.nullable? ? "null == returnValue ? null : " : '' }new java.util.#{method.return_value.collection_type == :set ? "HashSet" : "ArrayList" }<#{method.return_value.ejb.java_component_type(:transport) }>();\n"
       return_postfix << "  if( null != returnValue )\n    {\n" if method.return_value.nullable?
       return_postfix << <<LOOP
    for( final #{method.return_value.ejb.java_component_type(:boundary) } k: returnValue )
    {
      $returnValue.add(
LOOP
       if method.return_value.date?
         return_postfix << "org.realityforge.replicant.client.RDate.fromDate( k )"
       elsif method.return_value.enumeration.numeric_values?
         return_postfix << "k.ordinal()"
       elsif method.return_value.enumeration.textual_values?
         return_postfix << "k.name()"
       end
       return_postfix << ");\n    }\n"
       return_postfix << "    }\n" if method.return_value.nullable?
       return_postfix << "return $returnValue;\n"
       else
         return_postfix = "return returnValue;"
     end

   end
%>
<% method.parameters.select{|p|p.collection? && (p.date? || p.enumeration?)}.each do |parameter| %>
    final <%= annotated_type(parameter, :ejb, :boundary) %> $<%= parameter.name %> = <%= parameter.nullable? ? "null == #{parameter.name} ? null : " : '' %>new java.util.<%=  parameter.collection_type == :set ? "HashSet" : "ArrayList" %><<%= parameter.ejb.java_component_type(:boundary) %>>();
    <% if parameter.nullable? %>if( null != <%= parameter.name %> ) {<% end %>
    for( final <%= parameter.ejb.java_component_type(:transport) %> k: <%= parameter.name %> )
    {
    $<%= parameter.name %>.add( <%=
    parameter.date? ? "org.realityforge.replicant.client.RDate.toDate( k )" :
      parameter.enumeration.numeric_values? ? "#{parameter.enumeration.e.qualified_name}.values()[ k ]" :
        "#{parameter.enumeration.ee.qualified_name}.valueOf( k )"
%> );
    }
    <% if parameter.nullable? %>}<% end %>
<% end %>
    <%= return_prefix %>_service.<%= method.gwt.name %>(<%= method.parameters.collect do |p|
  if p.gwt.environmental?
    value = p.gwt.environment_value
  elsif p.collection? && (p.date? || p.enumeration?)
    value = "$#{p.gwt.name}"
  else
    transform = nil
    if p.date?
      transform = "org.realityforge.replicant.client.RDate.toDate( #{p.gwt.name} )"
    elsif p.enumeration?
      if p.enumeration.numeric_values?
        transform = "#{p.enumeration.ee.qualified_name}.values()[ #{p.gwt.name} ]"
      else
        transform = "#{p.enumeration.ee.qualified_name}.valueOf( #{p.gwt.name} )"
      end
    end
    if p.nullable? && transform
      transform = "(null == #{p.gwt.name} ? null : #{transform})"
    end
    value = transform || p.gwt.name
  end
  value
end.join(', ') %>);
  <%= return_postfix %>
<% if !method.exceptions.empty?
%>    }
<% method.exceptions.each do |exception| %>
    catch ( final <%= exception.ee.qualified_name %> ignored )
    {
        throw new <%= exception.gwt.qualified_name %>();
    }
<% end %>
<% end %>
  }
<% end %>}
